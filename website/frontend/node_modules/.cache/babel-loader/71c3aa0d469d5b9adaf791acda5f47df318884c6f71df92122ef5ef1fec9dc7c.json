{"ast":null,"code":"var _s = $RefreshSig$();\n// src/hooks/useDashboardStats.js\nimport { useEffect, useMemo, useState } from \"react\";\nimport api from \"../../../api/axios\";\nfunction sum(arr, key) {\n  return (arr || []).reduce((acc, r) => acc + (Number(r === null || r === void 0 ? void 0 : r[key]) || 0), 0);\n}\nfunction lastN(arr, n) {\n  return (arr || []).slice(0, n).reverse(); // your API orders DESC, sparkline wants oldest->newest\n}\nfunction toSeries(rows, key) {\n  return rows.map(r => Number(r === null || r === void 0 ? void 0 : r[key]) || 0);\n}\nfunction pickToday(rows, key) {\n  var _rows$;\n  // because you ORDER BY Timestamp DESC, rows[0] is the latest day\n  return Number(rows === null || rows === void 0 ? void 0 : (_rows$ = rows[0]) === null || _rows$ === void 0 ? void 0 : _rows$[key]) || 0;\n}\nexport function useDashboardStats(monitorId) {\n  _s();\n  const [data, setData] = useState(null);\n  const [err, setErr] = useState(\"\");\n  useEffect(() => {\n    if (!monitorId) return;\n\n    // last 7 days range (simple client-side range)\n    const to = new Date('2024-03-05');\n    const from = new Date();\n    from.setDate(to.getDate() - 6);\n    const fmt = d => d.toISOString().slice(0, 10);\n    api.get(`/api/monitor/${monitorId}/data`, {\n      params: {\n        from: fmt(from),\n        to: fmt(to)\n      }\n    }).then(res => setData(res.data)).catch(e => {\n      var _e$response, _e$response$data;\n      return setErr((e === null || e === void 0 ? void 0 : (_e$response = e.response) === null || _e$response === void 0 ? void 0 : (_e$response$data = _e$response.data) === null || _e$response$data === void 0 ? void 0 : _e$response$data.message) || \"Failed to load dashboard data\");\n    });\n  }, [monitorId]);\n  const stats = useMemo(() => {\n    var _resD$, _solD$, _solD$2;\n    if (!data) return [];\n    const consD = data._computed_energy_consumption_daily || [];\n    const prodD = data._computed_energy_production_daily || [];\n    const resD = data._computed_energy_reserves_daily || [];\n    const solD = data._computed_solar_panel_data_daily || [];\n    const cons7 = lastN(consD, 7);\n    const prod7 = lastN(prodD, 7);\n    const todayCons = pickToday(consD, \"Total_Consumption\");\n    const todayProd = pickToday(prodD, \"Total_Production\");\n    const netToday = todayProd - todayCons;\n    const seriesCons = toSeries(cons7, \"Total_Consumption\");\n    const seriesProd = toSeries(prod7, \"Total_Production\");\n    const todayReserve = Number(resD === null || resD === void 0 ? void 0 : (_resD$ = resD[0]) === null || _resD$ === void 0 ? void 0 : _resD$.Reserve_Amount) || 0;\n\n    // solar: choose the most â€œheadlineâ€ metric\n    const todaySolarGenerated = Number(solD === null || solD === void 0 ? void 0 : (_solD$ = solD[0]) === null || _solD$ === void 0 ? void 0 : _solD$.Total_Energy_Generated) || 0;\n    const todayEfficiency = Number(solD === null || solD === void 0 ? void 0 : (_solD$2 = solD[0]) === null || _solD$2 === void 0 ? void 0 : _solD$2.Panel_Efficiency) || 0;\n    return [{\n      icon: \"ðŸ”Œ\",\n      title: \"Today's Consumption\",\n      value: `${todayCons.toFixed(2)} kWh`,\n      description: \"Latest daily computed consumption.\",\n      color: \"#00ccff\",\n      series: seriesCons\n    }, {\n      icon: \"â˜€ï¸\",\n      title: \"Today's Production\",\n      value: `${todayProd.toFixed(2)} kWh`,\n      description: \"Latest daily computed production.\",\n      color: \"#ffcc00\",\n      series: seriesProd\n    }, {\n      icon: \"âš–ï¸\",\n      title: \"Net Energy Today\",\n      value: `${netToday.toFixed(2)} kWh`,\n      description: netToday >= 0 ? \"Producing more than consuming.\" : \"Consuming more than producing.\",\n      color: netToday >= 0 ? \"#4ecdc4\" : \"#ff6b6b\",\n      series: seriesProd.map((v, i) => {\n        var _seriesCons$i;\n        return v - ((_seriesCons$i = seriesCons[i]) !== null && _seriesCons$i !== void 0 ? _seriesCons$i : 0);\n      })\n    }, {\n      icon: \"ðŸª«\",\n      title: \"Reserve Amount\",\n      value: `${todayReserve.toFixed(2)}`,\n      description: \"Latest daily reserve value.\",\n      color: \"#00ffcc\",\n      series: toSeries(lastN(resD, 7), \"Reserve_Amount\")\n    }, {\n      icon: \"âš¡\",\n      title: \"Solar Generated Today\",\n      value: `${todaySolarGenerated.toFixed(2)} kWh`,\n      description: `Panel efficiency: ${todayEfficiency.toFixed(1)}%`,\n      color: \"#ff0080\",\n      series: toSeries(lastN(solD, 7), \"Total_Energy_Generated\")\n    }, {\n      icon: \"ðŸ“ˆ\",\n      title: \"7-Day Consumption Total\",\n      value: `${sum(cons7, \"Total_Consumption\").toFixed(2)} kWh`,\n      description: \"Sum of last 7 daily values.\",\n      color: \"#00ccff\",\n      series: seriesCons\n    }];\n  }, [data]);\n  return {\n    stats,\n    data,\n    err,\n    loading: !data && !err\n  };\n}\n_s(useDashboardStats, \"IuHASzycNnCPoT9VArxEkqSPDDQ=\");","map":{"version":3,"names":["useEffect","useMemo","useState","api","sum","arr","key","reduce","acc","r","Number","lastN","n","slice","reverse","toSeries","rows","map","pickToday","_rows$","useDashboardStats","monitorId","_s","data","setData","err","setErr","to","Date","from","setDate","getDate","fmt","d","toISOString","get","params","then","res","catch","e","_e$response","_e$response$data","response","message","stats","_resD$","_solD$","_solD$2","consD","_computed_energy_consumption_daily","prodD","_computed_energy_production_daily","resD","_computed_energy_reserves_daily","solD","_computed_solar_panel_data_daily","cons7","prod7","todayCons","todayProd","netToday","seriesCons","seriesProd","todayReserve","Reserve_Amount","todaySolarGenerated","Total_Energy_Generated","todayEfficiency","Panel_Efficiency","icon","title","value","toFixed","description","color","series","v","i","_seriesCons$i","loading"],"sources":["C:/Users/Admin/Desktop/senior-project/website/frontend/src/components/analytics/hooks/useDashboardStats.js"],"sourcesContent":["// src/hooks/useDashboardStats.js\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport api from \"../../../api/axios\";\r\n\r\nfunction sum(arr, key) {\r\n  return (arr || []).reduce((acc, r) => acc + (Number(r?.[key]) || 0), 0);\r\n}\r\n\r\nfunction lastN(arr, n) {\r\n  return (arr || []).slice(0, n).reverse(); // your API orders DESC, sparkline wants oldest->newest\r\n}\r\n\r\nfunction toSeries(rows, key) {\r\n  return rows.map((r) => Number(r?.[key]) || 0);\r\n}\r\n\r\nfunction pickToday(rows, key) {\r\n  // because you ORDER BY Timestamp DESC, rows[0] is the latest day\r\n  return Number(rows?.[0]?.[key]) || 0;\r\n}\r\n\r\nexport function useDashboardStats(monitorId) {\r\n  const [data, setData] = useState(null);\r\n  const [err, setErr] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    if (!monitorId) return;\r\n\r\n    // last 7 days range (simple client-side range)\r\n    const to = new Date('2024-03-05');\r\n    const from = new Date();\r\n    from.setDate(to.getDate() - 6);\r\n\r\n    const fmt = (d) => d.toISOString().slice(0, 10);\r\n\r\n    api\r\n      .get(`/api/monitor/${monitorId}/data`, {\r\n        params: { from: fmt(from), to: fmt(to) },\r\n      })\r\n      .then((res) => setData(res.data))\r\n      .catch((e) => setErr(e?.response?.data?.message || \"Failed to load dashboard data\"));\r\n  }, [monitorId]);\r\n\r\n  const stats = useMemo(() => {\r\n    if (!data) return [];\r\n\r\n    const consD = data._computed_energy_consumption_daily || [];\r\n    const prodD = data._computed_energy_production_daily || [];\r\n    const resD  = data._computed_energy_reserves_daily || [];\r\n    const solD  = data._computed_solar_panel_data_daily || [];\r\n\r\n    const cons7 = lastN(consD, 7);\r\n    const prod7 = lastN(prodD, 7);\r\n\r\n    const todayCons = pickToday(consD, \"Total_Consumption\");\r\n    const todayProd = pickToday(prodD, \"Total_Production\");\r\n    const netToday = todayProd - todayCons;\r\n\r\n    const seriesCons = toSeries(cons7, \"Total_Consumption\");\r\n    const seriesProd = toSeries(prod7, \"Total_Production\");\r\n\r\n    const todayReserve = Number(resD?.[0]?.Reserve_Amount) || 0;\r\n\r\n    // solar: choose the most â€œheadlineâ€ metric\r\n    const todaySolarGenerated = Number(solD?.[0]?.Total_Energy_Generated) || 0;\r\n    const todayEfficiency = Number(solD?.[0]?.Panel_Efficiency) || 0;\r\n\r\n    return [\r\n      {\r\n        icon: \"ðŸ”Œ\",\r\n        title: \"Today's Consumption\",\r\n        value: `${todayCons.toFixed(2)} kWh`,\r\n        description: \"Latest daily computed consumption.\",\r\n        color: \"#00ccff\",\r\n        series: seriesCons,\r\n      },\r\n      {\r\n        icon: \"â˜€ï¸\",\r\n        title: \"Today's Production\",\r\n        value: `${todayProd.toFixed(2)} kWh`,\r\n        description: \"Latest daily computed production.\",\r\n        color: \"#ffcc00\",\r\n        series: seriesProd,\r\n      },\r\n      {\r\n        icon: \"âš–ï¸\",\r\n        title: \"Net Energy Today\",\r\n        value: `${netToday.toFixed(2)} kWh`,\r\n        description: netToday >= 0 ? \"Producing more than consuming.\" : \"Consuming more than producing.\",\r\n        color: netToday >= 0 ? \"#4ecdc4\" : \"#ff6b6b\",\r\n        series: seriesProd.map((v, i) => v - (seriesCons[i] ?? 0)),\r\n      },\r\n      {\r\n        icon: \"ðŸª«\",\r\n        title: \"Reserve Amount\",\r\n        value: `${todayReserve.toFixed(2)}`,\r\n        description: \"Latest daily reserve value.\",\r\n        color: \"#00ffcc\",\r\n        series: toSeries(lastN(resD, 7), \"Reserve_Amount\"),\r\n      },\r\n      {\r\n        icon: \"âš¡\",\r\n        title: \"Solar Generated Today\",\r\n        value: `${todaySolarGenerated.toFixed(2)} kWh`,\r\n        description: `Panel efficiency: ${todayEfficiency.toFixed(1)}%`,\r\n        color: \"#ff0080\",\r\n        series: toSeries(lastN(solD, 7), \"Total_Energy_Generated\"),\r\n      },\r\n      {\r\n        icon: \"ðŸ“ˆ\",\r\n        title: \"7-Day Consumption Total\",\r\n        value: `${sum(cons7, \"Total_Consumption\").toFixed(2)} kWh`,\r\n        description: \"Sum of last 7 daily values.\",\r\n        color: \"#00ccff\",\r\n        series: seriesCons,\r\n      },\r\n    ];\r\n  }, [data]);\r\n\r\n  return { stats, data, err, loading: !data && !err };\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}