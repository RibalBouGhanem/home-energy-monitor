{"ast":null,"code":"var _s = $RefreshSig$();\n// src/components/analytics/hooks/useAnalyticsData.js\nimport { useEffect, useMemo, useState } from \"react\";\nimport api from \"../../../api/axios\";\nfunction safeNum(v) {\n  const n = Number(v);\n  return Number.isFinite(n) ? n : 0;\n}\nfunction sum(rows, key) {\n  return (rows || []).reduce((acc, r) => acc + safeNum(r === null || r === void 0 ? void 0 : r[key]), 0);\n}\nfunction avg(rows, key) {\n  if (!(rows !== null && rows !== void 0 && rows.length)) return 0;\n  return sum(rows, key) / rows.length;\n}\nfunction lastNDescToAsc(rows, n) {\n  // backend usually returns DESC; charts prefer ASC\n  return (rows || []).slice(0, n).reverse();\n}\nexport function useAnalyticsData(monitorId) {\n  _s();\n  const [raw, setRaw] = useState(null);\n  const [err, setErr] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  useEffect(() => {\n    if (!monitorId) return;\n    setLoading(true);\n    setErr(\"\");\n\n    // IMPORTANT: keep it simple and reliable: fetch all, then slice/filter client-side\n    api.get(`/api/monitor/${monitorId}/data`).then(res => setRaw(res.data)).catch(e => {\n      var _e$response, _e$response$data;\n      return setErr((e === null || e === void 0 ? void 0 : (_e$response = e.response) === null || _e$response === void 0 ? void 0 : (_e$response$data = _e$response.data) === null || _e$response$data === void 0 ? void 0 : _e$response$data.message) || \"Failed to load analytics data.\");\n    }).finally(() => setLoading(false));\n  }, [monitorId]);\n  const computed = useMemo(() => {\n    var _consD$, _prodD$, _solD$, _solD$2;\n    const consD = (raw === null || raw === void 0 ? void 0 : raw._computed_energy_consumption_daily) || [];\n    const prodD = (raw === null || raw === void 0 ? void 0 : raw._computed_energy_production_daily) || [];\n    const resD = (raw === null || raw === void 0 ? void 0 : raw._computed_energy_reserves_daily) || [];\n    const envD = (raw === null || raw === void 0 ? void 0 : raw._computed_environmental_data_daily) || [];\n    const solD = (raw === null || raw === void 0 ? void 0 : raw._computed_solar_panel_data_daily) || [];\n    const consM = (raw === null || raw === void 0 ? void 0 : raw._computed_energy_consumption_monthly) || [];\n    const prodM = (raw === null || raw === void 0 ? void 0 : raw._computed_energy_production_monthly) || [];\n    const resM = (raw === null || raw === void 0 ? void 0 : raw._computed_energy_reserves_monthly) || [];\n    const solM = (raw === null || raw === void 0 ? void 0 : raw._computed_solar_panel_data_monthly) || [];\n\n    // Recent windows (daily)\n    const cons7 = lastNDescToAsc(consD, 7);\n    const cons30 = lastNDescToAsc(consD, 30);\n    const prod7 = lastNDescToAsc(prodD, 7);\n    const prod30 = lastNDescToAsc(prodD, 30);\n    const solar7 = lastNDescToAsc(solD, 7);\n    const env7 = lastNDescToAsc(envD, 7);\n    const reserves7 = lastNDescToAsc(resD, 7);\n\n    // Metrics (pick what you actually have in tables)\n    const todayCons = safeNum(consD === null || consD === void 0 ? void 0 : (_consD$ = consD[0]) === null || _consD$ === void 0 ? void 0 : _consD$.Total_Consumption);\n    const todayProd = safeNum(prodD === null || prodD === void 0 ? void 0 : (_prodD$ = prodD[0]) === null || _prodD$ === void 0 ? void 0 : _prodD$.Total_Production);\n    const solarTodayGenerated = safeNum(solD === null || solD === void 0 ? void 0 : (_solD$ = solD[0]) === null || _solD$ === void 0 ? void 0 : _solD$.Total_Energy_Generated);\n    const solarTodayEff = safeNum(solD === null || solD === void 0 ? void 0 : (_solD$2 = solD[0]) === null || _solD$2 === void 0 ? void 0 : _solD$2.Panel_Efficiency);\n    const avgTemp7 = avg(env7, \"Temperature\");\n    const avgHumidity7 = avg(env7, \"Humidity\");\n    const net7 = cons7.map((r, i) => {\n      var _prod7$i;\n      return {\n        x: (r === null || r === void 0 ? void 0 : r.Timestamp) || (r === null || r === void 0 ? void 0 : r.Date),\n        y: safeNum(prod7 === null || prod7 === void 0 ? void 0 : (_prod7$i = prod7[i]) === null || _prod7$i === void 0 ? void 0 : _prod7$i.Total_Production) - safeNum(r === null || r === void 0 ? void 0 : r.Total_Consumption)\n      };\n    });\n    return {\n      // raw sets (expose if needed)\n      consD,\n      prodD,\n      resD,\n      envD,\n      solD,\n      consM,\n      prodM,\n      resM,\n      solM,\n      // for charts\n      cons7,\n      cons30,\n      prod7,\n      prod30,\n      solar7,\n      reserves7,\n      net7,\n      // headline numbers\n      todayCons,\n      todayProd,\n      solarTodayGenerated,\n      solarTodayEff,\n      avgTemp7,\n      avgHumidity7,\n      // month-to-date using daily slices (good enough visually)\n      mtdCons: sum(cons30, \"Total_Consumption\"),\n      mtdProd: sum(prod30, \"Total_Production\")\n    };\n  }, [raw]);\n  return {\n    raw,\n    ...computed,\n    loading,\n    err\n  };\n}\n_s(useAnalyticsData, \"s4CeKYOrI+HfRK12IdDg3dWICa0=\");","map":{"version":3,"names":["useEffect","useMemo","useState","api","safeNum","v","n","Number","isFinite","sum","rows","key","reduce","acc","r","avg","length","lastNDescToAsc","slice","reverse","useAnalyticsData","monitorId","_s","raw","setRaw","err","setErr","loading","setLoading","get","then","res","data","catch","e","_e$response","_e$response$data","response","message","finally","computed","_consD$","_prodD$","_solD$","_solD$2","consD","_computed_energy_consumption_daily","prodD","_computed_energy_production_daily","resD","_computed_energy_reserves_daily","envD","_computed_environmental_data_daily","solD","_computed_solar_panel_data_daily","consM","_computed_energy_consumption_monthly","prodM","_computed_energy_production_monthly","resM","_computed_energy_reserves_monthly","solM","_computed_solar_panel_data_monthly","cons7","cons30","prod7","prod30","solar7","env7","reserves7","todayCons","Total_Consumption","todayProd","Total_Production","solarTodayGenerated","Total_Energy_Generated","solarTodayEff","Panel_Efficiency","avgTemp7","avgHumidity7","net7","map","i","_prod7$i","x","Timestamp","Date","y","mtdCons","mtdProd"],"sources":["C:/Users/ribal/Desktop/Senior/website/frontend/src/components/analytics/hooks/useAnalyticsData.js"],"sourcesContent":["// src/components/analytics/hooks/useAnalyticsData.js\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport api from \"../../../api/axios\";\r\n\r\nfunction safeNum(v) {\r\n  const n = Number(v);\r\n  return Number.isFinite(n) ? n : 0;\r\n}\r\n\r\nfunction sum(rows, key) {\r\n  return (rows || []).reduce((acc, r) => acc + safeNum(r?.[key]), 0);\r\n}\r\n\r\nfunction avg(rows, key) {\r\n  if (!rows?.length) return 0;\r\n  return sum(rows, key) / rows.length;\r\n}\r\n\r\nfunction lastNDescToAsc(rows, n) {\r\n  // backend usually returns DESC; charts prefer ASC\r\n  return (rows || []).slice(0, n).reverse();\r\n}\r\n\r\nexport function useAnalyticsData(monitorId) {\r\n  const [raw, setRaw] = useState(null);\r\n  const [err, setErr] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!monitorId) return;\r\n\r\n    setLoading(true);\r\n    setErr(\"\");\r\n\r\n    // IMPORTANT: keep it simple and reliable: fetch all, then slice/filter client-side\r\n    api\r\n      .get(`/api/monitor/${monitorId}/data`)\r\n      .then((res) => setRaw(res.data))\r\n      .catch((e) => setErr(e?.response?.data?.message || \"Failed to load analytics data.\"))\r\n      .finally(() => setLoading(false));\r\n  }, [monitorId]);\r\n\r\n  const computed = useMemo(() => {\r\n    const consD = raw?._computed_energy_consumption_daily || [];\r\n    const prodD = raw?._computed_energy_production_daily || [];\r\n    const resD = raw?._computed_energy_reserves_daily || [];\r\n    const envD = raw?._computed_environmental_data_daily || [];\r\n    const solD = raw?._computed_solar_panel_data_daily || [];\r\n\r\n    const consM = raw?._computed_energy_consumption_monthly || [];\r\n    const prodM = raw?._computed_energy_production_monthly || [];\r\n    const resM = raw?._computed_energy_reserves_monthly || [];\r\n    const solM = raw?._computed_solar_panel_data_monthly || [];\r\n\r\n    // Recent windows (daily)\r\n    const cons7 = lastNDescToAsc(consD, 7);\r\n    const cons30 = lastNDescToAsc(consD, 30);\r\n    const prod7 = lastNDescToAsc(prodD, 7);\r\n    const prod30 = lastNDescToAsc(prodD, 30);\r\n\r\n    const solar7 = lastNDescToAsc(solD, 7);\r\n    const env7 = lastNDescToAsc(envD, 7);\r\n    const reserves7 = lastNDescToAsc(resD, 7);\r\n\r\n    // Metrics (pick what you actually have in tables)\r\n    const todayCons = safeNum(consD?.[0]?.Total_Consumption);\r\n    const todayProd = safeNum(prodD?.[0]?.Total_Production);\r\n\r\n    const solarTodayGenerated = safeNum(solD?.[0]?.Total_Energy_Generated);\r\n    const solarTodayEff = safeNum(solD?.[0]?.Panel_Efficiency);\r\n\r\n    const avgTemp7 = avg(env7, \"Temperature\");\r\n    const avgHumidity7 = avg(env7, \"Humidity\");\r\n\r\n    const net7 = cons7.map((r, i) => ({\r\n      x: r?.Timestamp || r?.Date,\r\n      y: safeNum(prod7?.[i]?.Total_Production) - safeNum(r?.Total_Consumption),\r\n    }));\r\n\r\n    return {\r\n      // raw sets (expose if needed)\r\n      consD, prodD, resD, envD, solD,\r\n      consM, prodM, resM, solM,\r\n\r\n      // for charts\r\n      cons7, cons30, prod7, prod30, solar7, reserves7, net7,\r\n\r\n      // headline numbers\r\n      todayCons, todayProd,\r\n      solarTodayGenerated, solarTodayEff,\r\n      avgTemp7, avgHumidity7,\r\n\r\n      // month-to-date using daily slices (good enough visually)\r\n      mtdCons: sum(cons30, \"Total_Consumption\"),\r\n      mtdProd: sum(prod30, \"Total_Production\"),\r\n    };\r\n  }, [raw]);\r\n\r\n  return { raw, ...computed, loading, err };\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}